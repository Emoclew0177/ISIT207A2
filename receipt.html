<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rental Receipt | AZoom Car Rental</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      background: var(--bg-color);
      color: var(--text-color);
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    .receipt-container {
      max-width: 540px;
      margin: 3rem auto;
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      padding: 2.5rem 2.5rem 2rem 2.5rem;
      border: 2px solid var(--accent-color);
    }
    .receipt-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .receipt-title {
      font-size: 2rem;
      font-weight: 800;
      color: var(--accent-color);
      letter-spacing: 1px;
      margin-bottom: 0.2rem;
    }
    .receipt-logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-color);
      margin-bottom: 0.5rem;
      letter-spacing: 2px;
    }
    .receipt-details {
      font-size: 1.08rem;
      line-height: 1.8;
      margin-bottom: 2rem;
      color: var(--text-color);
    }
    .receipt-section-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--accent-color);
      border-bottom: 1px solid var(--accent-color);
      padding-bottom: 0.2rem;
      display: inline-block;
    }
    .receipt-footer {
      text-align: center;
      color: var(--footer-text);
      font-size: 0.98rem;
      margin-top: 2.5rem;
    }
    .receipt-actions {
      text-align: center;
      margin-top: 2rem;
    }
    .receipt-actions button {
      background: var(--cta-bg);
      color: var(--cta-text);
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 700;
      padding: 0.7rem 2.2rem;
      margin: 0 0.7rem;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(34,197,94,0.07);
      transition: background 0.2s;
    }
    .receipt-actions button:hover {
      background: var(--accent-color);
      color: var(--text-color);
    }
    @media (max-width: 600px) {
      .receipt-container { padding: 1.2rem 0.5rem; }
    }
    b, strong {
      color: var(--accent-color);
    }
  </style>
</head>
<body>
  <div class="receipt-container" id="receiptContent">
    <div class="receipt-header">
      <div class="receipt-logo">AZOOM CAR RENTAL</div>
      <div class="receipt-title">Rental Receipt</div>
    </div>
    <div class="receipt-details" id="receiptDetails">
      <!-- Details will be injected by JS -->
    </div>
    <div class="receipt-actions">
      <button onclick="window.print()">Print</button>
      <button onclick="window.close()">Close</button>
    </div>
    <div class="receipt-footer">
      &copy; 2026 AZOOM. All rights reserved.
    </div>
  </div>
  <script>
    // Helper to get query params
    function getQueryParams() {
      const params = {};
      window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(str, key, value) {
        params[key] = decodeURIComponent(value);
      });
      return params;
    }
    function renderReceipt() {
      const params = getQueryParams();
      const rentalId = params.id;
      let reservations = [];
      try { reservations = JSON.parse(localStorage.getItem('azoom_reservations') || '[]'); } catch {}
      const res = reservations.find(r => r.rentalId === rentalId);
      const details = document.getElementById('receiptDetails');
      if (!res) {
        details.innerHTML = '<span style="color:#f33;font-weight:700;">Rental record not found.</span>';
        return;
      }
      let html = '';
      html += `<div><span class='receipt-section-title'>Rental Information</span></div>`;
      html += `<b>Rental ID:</b> ${res.rentalId || ''}<br>`;
      html += `<b>Customer:</b> ${res.user}<br>`;
      html += `<b>Car:</b> ${res.model}<br>`;
      // Show category if present (Standard, Comfort, Luxury)
      if (["Standard","Comfort","Luxury"].includes(res.category)) {
        html += `<b>Category:</b> ${res.category}<br>`;
      }
      // Capitalize pickup location
      let loc = (res.store || '').toLowerCase();
      let locName = '';
      if (loc === 'orchard') locName = 'Orchard';
      else if (loc === 'changi') locName = 'Changi';
      else locName = res.store ? res.store.charAt(0).toUpperCase() + res.store.slice(1) : '';
      html += `<b>Pickup Location:</b> ${locName}<br>`;
      html += `<b>Start Date:</b> ${res.startDate}<br>`;
      html += `<b>Duration:</b> ${res.duration} ${res.period}<br>`;
      html += `<b>Status:</b> ${res.status}<br>`;
      // Removed Created field
      html += `<div style='margin-top:1.2rem;'><span class='receipt-section-title'>Charges</span></div>`;
      html += `<b>Base Cost:</b> ${res.cost || ''}<br>`;
      // Show damage breakdown if present
      if (Array.isArray(res.damageItems) && res.damageItems.length > 0) {
        html += `<div style='margin:0.7rem 0 0.5rem 0;'><b>Damage Charges Breakdown:</b></div>`;
        html += `<ul style='margin:0 0 0.7rem 1.2rem;padding:0;'>`;
        res.damageItems.forEach(function(item, idx) {
          html += `<li style='margin-bottom:0.3rem;'><b>${item.type}</b> - $${parseFloat(item.amount).toFixed(2)}`;
          if (item.comment) html += `<br><span style='color:#666;font-size:0.97em;'>${item.comment}</span>`;
          html += `</li>`;
        });
        html += `</ul>`;
        html += `<b>Total Damage Charges:</b> $${res.extraBill ? parseFloat(res.extraBill).toFixed(2) : '0.00'}<br>`;
      } else if (res.extraBill && res.extraBill > 0) {
        html += `<b>Extra Bill (Damages):</b> $${res.extraBill}<br>`;
      }
      if (res.extraNotes) {
        html += `<b>Notes:</b> ${res.extraNotes}<br>`;
      }
      html += `<div style='margin-top:1.2rem;'><span class='receipt-section-title'>Payment Summary</span></div>`;
      html += `<b>Total Paid:</b> $${(parseFloat((res.cost||'').replace(/[^\d.]/g,'')) + (res.extraBill||0)).toFixed(2)}<br>`;
      html += `<b>Payment Status:</b> ${res.status === 'Completed' ? 'Paid in Full' : (res.status === 'Awaiting Payment' ? 'Pending Damages Payment' : 'In Progress')}<br>`;
      details.innerHTML = html;
    }
    renderReceipt();
  </script>
</body>
</html>
